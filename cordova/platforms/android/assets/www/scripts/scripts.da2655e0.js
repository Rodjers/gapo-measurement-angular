"use strict";var CordovaInit=function(){var a=function(){console.log(navigator.camera),b("deviceready")},b=function(a){console.log("Start event received, bootstrapping application setup."),angular.bootstrap($("body"),["gapoMeasurementApp"])};this.bindEvents=function(){document.addEventListener("deviceready",a,!1)},void 0!==window.cordova?(console.log("Cordova found, wating for device."),this.bindEvents()):(console.log("Cordova not found, booting application"),b("manual"))};$(function(){console.log("Bootstrapping!"),new CordovaInit}),angular.module("gapoMeasurementApp",["ngRoute","base64","ngMessages","ngMaterial","ngMdIcons","md.data.table"]).config(["$routeProvider","$mdThemingProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/list",{templateUrl:"views/list.html",controller:"ListCtrl"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl"}).otherwise({redirectTo:"/"}),b.theme("default")}]),angular.module("gapoMeasurementApp").factory("Camera",["$q","JiraRest",function(a,b){return{getPicture:function(c,d){var e=a.defer();return navigator.camera.getPicture(function(a){b.uploadImage(a,d),e.resolve(a)},function(a){e.reject(a)},c),e.promise}}}]),angular.module("gapoMeasurementApp").service("JiraRest",["$http","$base64","$rootScope","UtilityService",function(a,b,c,d){a.defaults.headers.common.Authorization="Basic "+b.encode("oddgeir:lyse1234");var e="http://intra.gapo.no/rest/api/2";return{login:function(d,f){a.get(e+"/user",{params:{username:d},headers:{Authorization:"Basic "+b.encode(d+":"+f)}}).then(function(e){return a.defaults.headers.common.Authorization="Basic "+b.encode(d+":"+f),c.isLoggedIn=!0,!0},function(a,b,d){return c.isLoggedIn=!1,!1})},addMeasurement:function(b){return a.post(e+"/issue",b)},getDefaultMeasurement:function(){return a.get(e+"/issue/GM-1")},getMetaMeasurement:function(){return a.get(e+"/issue/GM-1/editmeta")},getMeasurements:function(){return a.get(e+'/search?jql=issuetype=Garasjeport+and+status=Open+or+status="Måler"')},updateMeasurement:function(b){var c=d.trimIssue(b);return a.put(e+"/issue/"+b.id,c)},startMeasurement:function(b){var c={transition:{id:"201"}};return a.post(e+"/issue/"+b+"/transitions?expand=transitions.fields",c)},uploadImage:function(b,c){for(var d=atob(b),f=new Array(d.length),g=0;g<d.length;g++)f[g]=d.charCodeAt(g);var h=new Uint8Array(f),i=new Blob([h],{type:"image/png"}),j=new FormData;return j.append("file",i),a.post(e+"/issue/"+c+"/attachments",j,{transformRequest:angular.identity,headers:{"Content-Type":void 0,"X-Atlassian-Token":"no-check"}})}}}]),angular.module("gapoMeasurementApp").service("UtilityService",function(){return{trimIssue:function(a){var b={fields:{}};return b.fields.customfield_10011=angular.copy(a.fields.customfield_10011),b.fields.customfield_10013=angular.copy(a.fields.customfield_10013),b.fields.customfield_10014=angular.copy(a.fields.customfield_10014),b.fields.customfield_10015=angular.copy(a.fields.customfield_10015),b.fields.customfield_10300=angular.copy(a.fields.customfield_10300),b.fields.customfield_10301=angular.copy(a.fields.customfield_10301),b.fields.customfield_10302=angular.copy(a.fields.customfield_10302),b.fields.customfield_10303=angular.copy(a.fields.customfield_10303),b.fields.customfield_10304=angular.copy(a.fields.customfield_10304),b.fields.customfield_10305=angular.copy(a.fields.customfield_10305),b.fields.customfield_10306=angular.copy(a.fields.customfield_10306),b.fields.customfield_10308=angular.copy(a.fields.customfield_10308),b.fields.summary=angular.copy(a.fields.summary),b.fields.project=angular.copy(a.fields.project),b.fields.issuetype=angular.copy(a.fields.issuetype),b.id=angular.copy(a.id),b.key=angular.copy(a.key),b}}}),angular.module("gapoMeasurementApp").controller("MainCtrl",["$scope","$mdDialog","$http","$base64","Camera","JiraRest","$rootScope","UtilityService","$mdToast","$document",function(a,b,c,d,e,f,g,h,i,j){function k(a){a.fields.customfield_10308.id=localStorage.getItem("employeeId")}function l(){var b=localStorage.getItem("employeeId");a.currentIssue={fields:{customfield_10308:{id:b},project:{id:"10100"},issuetype:{id:"10200"}}}}void 0!=g.rootMeasurement?(a.currentIssue=angular.copy(g.rootMeasurement),k(a.currentIssue)):void 0==a.currentIssue&&l(),a.filter={savingMeasurement:!1},a.init=function(){l()},a.login=function(a,b){f.login(a,b)},a.chooseSource=function(c){b.show({clickOutsideToClose:!0,scope:a,preserveScope:!0,parent:angular.element(document.body),targetEvent:c,templateUrl:"views/chooseSource.html",controller:["$scope","$mdDialog","Camera",function(a,b,c){a.getPhoto=function(d){a.currentIssue.key?c.getPicture({encodingType:1,destinationType:0,sourceType:d},a.currentIssue.key).then(function(c){b.hide(),a.showToast("Bilde lagt til")},function(c){console.err(c),b.hide(),a.showToast("Noe gikk galt under lagring av bilde")}):alert("Lagre måltakningen før du legger til bilde")}}]})},a.showToast=function(a){i.show(i.simple().content(a).parent(j[0].querySelector("#saveButton")).position("bottom right").hideDelay(3e3))},a.showCustomToast=function(a){i.show({controller:"ToastCtrl",template:"<md-toast><span flex>"+a+"</span></md-toast>",parent:j[0].querySelector("#toastBase"),hideDelay:2e3,position:"top right"})},a.addMeasurement=function(b){f.addMeasurement(b).then(function(b){a.filter.savingMeasurement=!0,a.currentIssue.id=b.data.id,a.currentIssue.key=b.data.key,f.startMeasurement(a.currentIssue.id).then(function(b){a.filter.savingMeasurement=!1,a.showToast("Måltakning lagret")},function(b){a.filter.savingMeasurement=!1,a.showToast("Noe gikk galt under lagring av mål")})},function(b){a.filter.savingMeasurement=!1,a.showToast("Noe gikk galt under lagring av mål"),console.log(b)})},a.updateMeasurement=function(b){a.filter.savingMeasurement=!0,f.updateMeasurement(b).then(function(c){"Open"==b.fields.status.name?f.startMeasurement(b.id).then(function(b){a.filter.savingMeasurement=!1,a.showToast("Måltakning lagret")},function(b){console.log(b),a.filter.savingMeasurement=!1,a.showToast("Noe gikk galt under lagring av mål")}):(a.filter.savingMeasurement=!1,a.showToast("Måltakning lagret"))},function(b){console.log(b),a.filter.savingMeasurement=!1,a.showToast("Noe gikk galt under lagring av mål")})}}]),angular.module("gapoMeasurementApp").controller("ListCtrl",["$scope","$http","JiraRest","$location","$rootScope","$filter",function(a,b,c,d,e,f){a.filter={fetchingList:!0},a.measurements=[],a.searchInProgress={fields:{customfield_10308:{id:localStorage.getItem("employeeId")},status:{name:"Måler"}}},a.searchOpen={fields:{customfield_10308:{id:localStorage.getItem("employeeId")},status:{name:"Open"}}},c.getMeasurements().then(function(b){a.filter.fetchingList=!1,a.futureMeasurements=angular.copy(f("filter")(b.data.issues,a.searchOpen)),a.currentMeasurements=angular.copy(f("filter")(b.data.issues,a.searchInProgress))},function(b){a.filter.fetchingList=!1}),a.chooseFutureMeasurement=function(b){e.rootMeasurement=angular.copy(a.futureMeasurements[b]),d.path("/")},a.chooseCurrentMeasurement=function(b){e.rootMeasurement=angular.copy(a.currentMeasurements[b]),d.path("/")}}]),angular.module("gapoMeasurementApp").controller("SettingsCtrl",["$scope","$rootScope",function(a,b){a.setEmployee=function(a){localStorage.setItem("employeeId",a)}}]),angular.module("gapoMeasurementApp").controller("ToastCtrl",["$scope","$mdToast",function(a,b){a.closeToast=function(){b.hide()}}]),angular.module("gapoMeasurementApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("gapoMeasurementApp").controller("NavbarCtrl",["$scope","$location",function(a,b){a.menu=[{title:"Register",link:"/"},{title:"List",link:"/list"}],a.isCollapsed=!0,a.isActive=function(a){return a===b.path()}}]);